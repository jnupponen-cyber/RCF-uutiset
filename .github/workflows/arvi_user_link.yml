name: Arvi User Link → Discord

on:
  workflow_dispatch:
    inputs:
      url:
        description: "Linkki (uutinen / YouTube / blogi…)"
        required: true
        type: string
      note:
        description: "Valinnainen huomio Arville (lisäkonteksti)"
        required: false
        type: string

permissions:
  contents: read

jobs:
  post:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install deps
        run: |
          python -m pip install --upgrade pip
          pip install requests feedparser

      - name: Run poster
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
          OPENAI_API_KEY:      ${{ secrets.OPENAI_API_KEY }}
          OPENAI_API_BASE:     https://api.openai.com/v1
          SUMMARY_MODEL:       gpt-4o-mini
          COMMENT_MAXLEN:      "240"           # Arvin kommentin maksimipituus
          PREFER_LARGE_IMAGE:  "1"             # 1=image, 0=thumbnail
          SOURCE_COLOR_HEX:    "0x5865F2"      # yleisväri, ellei halua lähdekohtaisia
          INPUT_URL:           ${{ inputs.url }}
          INPUT_NOTE:          ${{ inputs.note }}
        run: |
          python scripts/arvi_user_link.py
